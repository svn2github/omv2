# This file is part of OpenMediaVault.
#
# @license   http://www.gnu.org/licenses/gpl.html GPL Version 3
# @author    Volker Theile <volker.theile@openmediavault.org>
# @copyright Copyright (c) 2009-2016 Volker Theile
#
# OpenMediaVault is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.
#
# OpenMediaVault is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with OpenMediaVault. If not, see <http://www.gnu.org/licenses/>.

# Testing:
# deviceid=$(udevadm info --device-id-of-file=/); echo ${deviceid}
# devicefile=$(readlink -f /dev/block/${deviceid}); echo ${devicefile}
# udevadm info -a --name=${devicefile}
# udevadm trigger --property-match=DEVNAME=${devicefile}
# udevadm test /sys/class/block/$(basename ${devicefile})
#
# udevadm test /sys/class/block/sda1
# udevadm control --reload-rules
# udevadm trigger --property-match=DEVNAME=/dev/sda1

ACTION!="add|change", GOTO="write_dev_root_link_rules_end"
SUBSYSTEM!="block", GOTO="write_dev_root_link_rules_end"

# Multimedia Card (MMC) devices
KERNEL=="mmcblk[0-9]p[0-9]", ENV{ID_NAME}=="?*", ENV{ID_SERIAL}=="?*", GOTO="write_dev_root_link_rules_start"

# Skip everything else except ATA and SCSI devices
ENV{ID_BUS}!="scsi|ata", GOTO="write_dev_root_link_rules_end"
NAME=="?*", GOTO="write_dev_root_link_rules_end"

LABEL="write_dev_root_link_rules_start"
DRIVERS=="?*", IMPORT{program}="omv-write_dev_root_link_rules"

LABEL="write_dev_root_link_rules_end"
